# å¤§æ¨¡å‹å¦‚ä½•é€‰æ‹©å·¥å…·ï¼Ÿkubernetes_mcp.py ä¸­çš„æ³¨é‡Šé‡è¦å—ï¼Ÿ

## ğŸ“‹ æ ¸å¿ƒç­”æ¡ˆ

**ç®€çŸ­å›ç­”ï¼š**

1. **`kubernetes_mcp.py` æ–‡ä»¶ä¸­çš„æ³¨é‡Šå’Œ docstring å¯¹å·¥å…·é€‰æ‹©æ²¡æœ‰å½±å“**
2. **å¤§æ¨¡å‹é€‰æ‹©å·¥å…·çš„ä¾æ®æ˜¯å·¥å…·çš„ `name` å’Œ `description`**
3. **è¿™äº›ä¿¡æ¯æ¥è‡ª MCP æœåŠ¡å™¨ï¼Œä¸åœ¨ `kubernetes_mcp.py` ä¸­**

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. å¤§æ¨¡å‹å¦‚ä½•é€‰æ‹©å·¥å…·ï¼Ÿ

å¤§æ¨¡å‹é€‰æ‹©å·¥å…·æ—¶ï¼Œä¸»è¦ä¾æ®ä»¥ä¸‹ä¿¡æ¯ï¼š

```python
å·¥å…·å¯¹è±¡ {
    name: "kubectl_get",           # å·¥å…·åç§°
    description: "Get Kubernetes resources...",  # å·¥å…·æè¿°ï¼ˆæœ€å…³é”®ï¼‰
    args_schema: {...}              # å‚æ•°å®šä¹‰
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… **`description` æ˜¯æœ€é‡è¦çš„**ï¼šå¤§æ¨¡å‹é€šè¿‡é˜…è¯»æè¿°æ¥åˆ¤æ–­å·¥å…·æ˜¯å¦é€‚åˆå½“å‰ä»»åŠ¡
- âœ… **`name` ä¹Ÿå¾ˆé‡è¦**ï¼šå·¥å…·åç§°å¸®åŠ©å¤§æ¨¡å‹å¿«é€Ÿè¯†åˆ«
- âœ… **`args_schema`**ï¼šå®šä¹‰å·¥å…·éœ€è¦ä»€ä¹ˆå‚æ•°

### 2. å·¥å…·æè¿°æ¥è‡ªå“ªé‡Œï¼Ÿ

**å·¥å…·çš„æè¿°ä¿¡æ¯æ¥è‡ª MCP æœåŠ¡å™¨ï¼Œä¸åœ¨ `kubernetes_mcp.py` ä¸­ï¼**

#### å·¥ä½œæµç¨‹ï¼š

```
æ­¥éª¤ 1: kubernetes_mcp.py åˆ›å»º MultiServerMCPClient
    â†“
æ­¥éª¤ 2: å¯åŠ¨ MCP æœåŠ¡å™¨å­è¿›ç¨‹ (npx mcp-server-kubernetes)
    â†“
æ­¥éª¤ 3: é€šè¿‡ stdio åè®®ä¸ MCP æœåŠ¡å™¨é€šä¿¡
    â†“
æ­¥éª¤ 4: è°ƒç”¨ await client.get_tools()
    â†“
æ­¥éª¤ 5: MCP æœåŠ¡å™¨è¿”å›å·¥å…·åˆ—è¡¨ï¼ˆåŒ…å« nameã€descriptionã€args_schemaï¼‰
    â†“
æ­¥éª¤ 6: è¿™äº›å·¥å…·å¯¹è±¡è¢«æ·»åŠ åˆ° Agent çš„å·¥å…·åˆ—è¡¨ä¸­
    â†“
æ­¥éª¤ 7: å¤§æ¨¡å‹çœ‹åˆ°å·¥å…·åˆ—è¡¨ï¼Œæ ¹æ® description é€‰æ‹©å·¥å…·
```

**å…³é”®ç†è§£ï¼š**

- `kubernetes_mcp.py` åªæ˜¯**è·å–**å·¥å…·ï¼Œä¸**å®šä¹‰**å·¥å…·
- å·¥å…·çš„æè¿°ã€å‚æ•°ç­‰ä¿¡æ¯éƒ½åœ¨ **MCP æœåŠ¡å™¨**ï¼ˆ`mcp-server-kubernetes`ï¼‰ä¸­å®šä¹‰
- è¿™äº›ä¿¡æ¯æ˜¯ MCP æœåŠ¡å™¨é€šè¿‡ MCP åè®®è¿”å›çš„

### 3. kubernetes_mcp.py ä¸­çš„æ³¨é‡Šé‡è¦å—ï¼Ÿ

**ç­”æ¡ˆï¼šä¸é‡è¦ï¼ˆå¯¹å·¥å…·é€‰æ‹©è€Œè¨€ï¼‰**

#### æ–‡ä»¶ä¸­çš„æ³¨é‡Šç±»å‹ï¼š

```python
# 1. æ–‡ä»¶é¡¶éƒ¨çš„æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²
"""
Kubernetes MCP é›†æˆæ¨¡å—
ç”¨äºå°† Kubernetes MCP æœåŠ¡å™¨çš„å·¥å…·é›†æˆåˆ° Agent ä¸­
"""
# âŒ å¤§æ¨¡å‹çœ‹ä¸åˆ°è¿™ä¸ª

# 2. ç±»çš„æ–‡æ¡£å­—ç¬¦ä¸²
class KubernetesMCPManager:
    """Kubernetes MCP ç®¡ç†å™¨"""
    # âŒ å¤§æ¨¡å‹çœ‹ä¸åˆ°è¿™ä¸ª

# 3. æ–¹æ³•çš„æ–‡æ¡£å­—ç¬¦ä¸²
def __init__(self, ...):
    """
    åˆå§‹åŒ– Kubernetes MCP ç®¡ç†å™¨
    
    Args:
        non_destructive: æ˜¯å¦å¯ç”¨éç ´åæ€§æ¨¡å¼
    """
    # âŒ å¤§æ¨¡å‹çœ‹ä¸åˆ°è¿™ä¸ª

# 4. ä»£ç æ³¨é‡Š
# å¦‚æœå¯ç”¨éç ´åæ€§æ¨¡å¼
if self.non_destructive:
    # âŒ å¤§æ¨¡å‹çœ‹ä¸åˆ°è¿™ä¸ª
```

**ä¸ºä»€ä¹ˆå¤§æ¨¡å‹çœ‹ä¸åˆ°ï¼Ÿ**

1. **è¿™äº›æ³¨é‡Šä¸åœ¨å·¥å…·å¯¹è±¡ä¸­**ï¼šå¤§æ¨¡å‹åªèƒ½çœ‹åˆ°å·¥å…·å¯¹è±¡çš„ `name`ã€`description`ã€`args_schema`
2. **è¿™äº›æ³¨é‡Šåªæ˜¯ç»™å¼€å‘è€…çœ‹çš„**ï¼šå¸®åŠ©å¼€å‘è€…ç†è§£ä»£ç 
3. **å·¥å…·çš„æè¿°åœ¨ MCP æœåŠ¡å™¨ä¸­**ï¼šMCP æœåŠ¡å™¨å®šä¹‰äº†æ¯ä¸ªå·¥å…·çš„æè¿°

---

## ğŸ¯ å®é™…éªŒè¯

### æŸ¥çœ‹å·¥å…·çš„å®é™…ä¿¡æ¯

è¿è¡Œä»¥ä¸‹ä»£ç å¯ä»¥çœ‹åˆ°å·¥å…·çš„å®é™…ä¿¡æ¯ï¼š

```python
import asyncio
from app.core.mcp_servers.kubernetes_mcp import get_kubernetes_mcp_tools

async def test():
    tools = await get_kubernetes_mcp_tools()
    if tools:
        tool = tools[0]  # å–ç¬¬ä¸€ä¸ªå·¥å…·
        print(f"å·¥å…·åç§°: {tool.name}")
        print(f"å·¥å…·æè¿°: {tool.description}")
        print(f"å·¥å…·å‚æ•°: {tool.args_schema}")

asyncio.run(test())
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å·¥å…·åç§°: kubectl_get
å·¥å…·æè¿°: Get Kubernetes resources. Supports all kubectl get commands...
å·¥å…·å‚æ•°: {
    "type": "object",
    "properties": {
        "resourceType": {"type": "string", "description": "Resource type..."},
        "name": {"type": "string", "description": "Resource name..."},
        ...
    }
}
```

**å…³é”®è§‚å¯Ÿï¼š**

- âœ… å·¥å…·åç§°ï¼š`kubectl_get`
- âœ… å·¥å…·æè¿°ï¼š`Get Kubernetes resources. Supports all kubectl get commands...`
- âœ… è¿™äº›ä¿¡æ¯æ¥è‡ª MCP æœåŠ¡å™¨ï¼Œä¸æ˜¯ `kubernetes_mcp.py` ä¸­çš„æ³¨é‡Š

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

### kubernetes_mcp.py ä¸­çš„æ³¨é‡Š vs å·¥å…·æè¿°

| ä½ç½® | å†…å®¹ | å¤§æ¨¡å‹èƒ½çœ‹åˆ°å—ï¼Ÿ | å½±å“å·¥å…·é€‰æ‹©å—ï¼Ÿ |
|------|------|----------------|----------------|
| æ–‡ä»¶é¡¶éƒ¨ docstring | `"""Kubernetes MCP é›†æˆæ¨¡å—"""` | âŒ ä¸èƒ½ | âŒ ä¸å½±å“ |
| ç±» docstring | `"""Kubernetes MCP ç®¡ç†å™¨"""` | âŒ ä¸èƒ½ | âŒ ä¸å½±å“ |
| æ–¹æ³• docstring | `"""åˆå§‹åŒ– Kubernetes MCP ç®¡ç†å™¨"""` | âŒ ä¸èƒ½ | âŒ ä¸å½±å“ |
| ä»£ç æ³¨é‡Š | `# å¦‚æœå¯ç”¨éç ´åæ€§æ¨¡å¼` | âŒ ä¸èƒ½ | âŒ ä¸å½±å“ |
| **å·¥å…·å¯¹è±¡.name** | `"kubectl_get"` | âœ… **èƒ½** | âœ… **å½±å“** |
| **å·¥å…·å¯¹è±¡.description** | `"Get Kubernetes resources..."` | âœ… **èƒ½** | âœ… **å½±å“ï¼ˆæœ€å…³é”®ï¼‰** |
| **å·¥å…·å¯¹è±¡.args_schema** | `{...}` | âœ… **èƒ½** | âœ… **å½±å“** |

---

## ğŸ”§ å¦‚ä½•ä¿®æ”¹å·¥å…·æè¿°ï¼Ÿ

### å¦‚æœä½ æƒ³ä¿®æ”¹å·¥å…·çš„æè¿°ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

#### é€‰é¡¹ 1ï¼šä¿®æ”¹ MCP æœåŠ¡å™¨æºç ï¼ˆä¸æ¨èï¼‰

å¦‚æœä½ æœ‰ MCP æœåŠ¡å™¨çš„æºç ï¼Œå¯ä»¥ä¿®æ”¹æœåŠ¡å™¨ä¸­çš„å·¥å…·å®šä¹‰ï¼š

```typescript
// åœ¨ mcp-server-kubernetes æºç ä¸­
{
  name: "kubectl_get",
  description: "ä½ çš„è‡ªå®šä¹‰æè¿°...",  // ä¿®æ”¹è¿™é‡Œ
  inputSchema: {...}
}
```

**ç¼ºç‚¹ï¼š**
- éœ€è¦ç»´æŠ¤ MCP æœåŠ¡å™¨çš„ fork
- æ›´æ–° MCP æœåŠ¡å™¨æ—¶éœ€è¦é‡æ–°ä¿®æ”¹

#### é€‰é¡¹ 2ï¼šåŒ…è£…å·¥å…·ï¼ˆæ¨èï¼‰

åœ¨è·å–å·¥å…·åï¼Œä¿®æ”¹å·¥å…·çš„æè¿°ï¼š

```python
async def get_kubernetes_mcp_tools(...):
    tools = await _kubernetes_mcp_manager.get_tools()
    
    # ä¿®æ”¹å·¥å…·æè¿°
    for tool in tools:
        if tool.name == "kubectl_get":
            # ä¿®æ”¹æè¿°
            tool.description = "ä½ çš„è‡ªå®šä¹‰æè¿°..."
    
    return tools
```

**ä¼˜ç‚¹ï¼š**
- ä¸éœ€è¦ä¿®æ”¹ MCP æœåŠ¡å™¨
- å¯ä»¥é’ˆå¯¹ç‰¹å®šå·¥å…·è‡ªå®šä¹‰æè¿°

---

## ğŸ’¡ å…³é”®ç†è§£

### 1. å·¥å…·é€‰æ‹©çš„æµç¨‹

```
ç”¨æˆ·æé—®: "æŸ¥çœ‹é›†ç¾¤ä¸­çš„ Pod"
    â†“
å¤§æ¨¡å‹åˆ†æé—®é¢˜
    â†“
æŸ¥çœ‹å¯ç”¨å·¥å…·åˆ—è¡¨ï¼ˆæ¯ä¸ªå·¥å…·éƒ½æœ‰ name å’Œ descriptionï¼‰
    â†“
æ ¹æ® description åŒ¹é…é—®é¢˜
    â†“
é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ï¼ˆä¾‹å¦‚ï¼škubectl_getï¼‰
    â†“
è°ƒç”¨å·¥å…·
```

### 2. kubernetes_mcp.py çš„ä½œç”¨

**`kubernetes_mcp.py` çš„ä½œç”¨æ˜¯ï¼š**

1. âœ… **åˆ›å»º MCP å®¢æˆ·ç«¯**ï¼šé…ç½®å¦‚ä½•å¯åŠ¨ MCP æœåŠ¡å™¨
2. âœ… **è·å–å·¥å…·åˆ—è¡¨**ï¼šä» MCP æœåŠ¡å™¨è·å–å·¥å…·
3. âœ… **ç®¡ç†è¿æ¥**ï¼šç®¡ç†å®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸ
4. âŒ **ä¸å®šä¹‰å·¥å…·æè¿°**ï¼šå·¥å…·æè¿°åœ¨ MCP æœåŠ¡å™¨ä¸­

### 3. å·¥å…·æè¿°åœ¨å“ªé‡Œï¼Ÿ

**å·¥å…·çš„æè¿°åœ¨ MCP æœåŠ¡å™¨ä¸­å®šä¹‰ï¼š**

- **ä½ç½®**ï¼š`mcp-server-kubernetes` npm åŒ…çš„æºç ä¸­
- **æ ¼å¼**ï¼šé€šè¿‡ MCP åè®®è¿”å›
- **å†…å®¹**ï¼šæ¯ä¸ªå·¥å…·çš„åç§°ã€æè¿°ã€å‚æ•°å®šä¹‰

**ç¤ºä¾‹ï¼ˆMCP æœåŠ¡å™¨å†…éƒ¨å®šä¹‰ï¼‰ï¼š**

```typescript
// åœ¨ mcp-server-kubernetes ä¸­
{
  name: "kubectl_get",
  description: "Get Kubernetes resources. Supports all kubectl get commands including pods, services, deployments, etc.",
  inputSchema: {
    type: "object",
    properties: {
      resourceType: {
        type: "string",
        description: "The type of Kubernetes resource to get"
      },
      // ...
    }
  }
}
```

---

## ğŸ¯ æ€»ç»“

### å›ç­”ä½ çš„é—®é¢˜ï¼š

1. **`kubernetes_mcp.py` ä¸­çš„æ³¨é‡Šé‡è¦å—ï¼Ÿ**
   - âŒ **ä¸é‡è¦**ï¼ˆå¯¹å·¥å…·é€‰æ‹©è€Œè¨€ï¼‰
   - è¿™äº›æ³¨é‡Šåªæ˜¯ç»™å¼€å‘è€…çœ‹çš„ï¼Œå¤§æ¨¡å‹çœ‹ä¸åˆ°

2. **å¤§æ¨¡å‹æ ¹æ®ä»€ä¹ˆé€‰æ‹©å·¥å…·ï¼Ÿ**
   - âœ… **å·¥å…·çš„ `description`**ï¼ˆæœ€å…³é”®ï¼‰
   - âœ… **å·¥å…·çš„ `name`**
   - âœ… **å·¥å…·çš„ `args_schema`**

3. **å·¥å…·æè¿°åœ¨å“ªé‡Œï¼Ÿ**
   - âœ… **åœ¨ MCP æœåŠ¡å™¨ä¸­**ï¼ˆ`mcp-server-kubernetes`ï¼‰
   - âŒ **ä¸åœ¨ `kubernetes_mcp.py` ä¸­**

4. **å¯ä»¥ä¿®æ”¹å·¥å…·æè¿°å—ï¼Ÿ**
   - âœ… **å¯ä»¥**ï¼šé€šè¿‡åŒ…è£…å·¥å…·ä¿®æ”¹æè¿°
   - âŒ **ä¸èƒ½**ï¼šç›´æ¥ä¿®æ”¹ `kubernetes_mcp.py` ä¸­çš„æ³¨é‡Šä¸ä¼šå½±å“å·¥å…·é€‰æ‹©

### å…³é”®ç‚¹ï¼š

- **`kubernetes_mcp.py` åªæ˜¯è·å–å·¥å…·çš„å·¥å…·ï¼Œä¸å®šä¹‰å·¥å…·**
- **å·¥å…·çš„æè¿°ã€å‚æ•°ç­‰ä¿¡æ¯éƒ½åœ¨ MCP æœåŠ¡å™¨ä¸­**
- **å¤§æ¨¡å‹åªèƒ½çœ‹åˆ°å·¥å…·å¯¹è±¡çš„å±æ€§ï¼Œçœ‹ä¸åˆ°ä»£ç æ³¨é‡Š**
- **å¦‚æœä½ æƒ³å½±å“å·¥å…·é€‰æ‹©ï¼Œéœ€è¦ä¿®æ”¹å·¥å…·å¯¹è±¡çš„ `description` å±æ€§**

